(window.webpackJsonp=window.webpackJsonp||[]).push([[77,73,123],{"013z":function(e,t,a){"use strict";var n=a("q1tI"),c=a.n(n),i=a("NmYn"),r=a.n(i),s=a("Wbzz"),o=a("Xrax"),l=a("k4MR"),b=a("TSYQ"),p=a.n(b),m=a("QH2O"),d=a.n(m),u=a("qKvR"),g=function(e){var t,a=e.title,n=e.theme,c=e.tabs,i=void 0===c?[]:c;return Object(u.b)("div",{className:p()(d.a.pageHeader,(t={},t[d.a.withTabs]=i.length,t[d.a.darkMode]="dark"===n,t))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:d.a.text},a)))))},h=a("BAC9"),j=function(e){var t=e.relativePagePath,a=e.repository,n=Object(s.useStaticQuery)("1364590287").site.siteMetadata.repository,c=a||n,i=c.baseUrl,r=c.subDirectory,o=i+"/edit/"+c.branch+r+"/src/pages"+t;return i?Object(u.b)("div",{className:"bx--row "+h.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:h.link,href:o},"Edit this page on GitHub"))):null},O=a("FCXl"),y=a("dI71"),f=a("I8xM"),N=function(e){function t(){return e.apply(this,arguments)||this}return Object(y.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,n=e.slug,c=n.split("/").filter(Boolean).slice(-1)[0],i=a.map((function(e){var t,a=r()(e,{lower:!0,strict:!0}),i=a===c,o=new RegExp(c+"/?(#.*)?$"),l=n.replace(o,a);return Object(u.b)("li",{key:e,className:p()((t={},t[f.selectedItem]=i,t),f.listItem)},Object(u.b)(s.Link,{className:f.link,to:""+l},e))}));return Object(u.b)("div",{className:f.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",{"aria-label":t},Object(u.b)("ul",{className:f.list},i))))))},t}(c.a.Component),v=a("MjG9"),k=a("CzIb"),w=a("Asxa"),I=a("OIbQ"),x=a.n(I),T=function(e){var t=e.date,a=new Date(t);return t?Object(u.b)(w.c,{className:x.a.row},Object(u.b)(w.a,null,Object(u.b)("div",{className:x.a.text},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,a=e.children,n=e.location,c=e.Title,i=t.frontmatter,b=void 0===i?{}:i,p=t.relativePagePath,m=t.titleType,d=b.tabs,h=b.title,y=b.theme,f=b.description,w=b.keywords,I=b.date,x=Object(k.a)().interiorTheme,A=Object(s.useStaticQuery)("2456312558").site.pathPrefix,S=A?n.pathname.replace(A,""):n.pathname,P=d?S.split("/").filter(Boolean).slice(-1)[0]||r()(d[0],{lower:!0}):"",C=y||x;return Object(u.b)(l.a,{tabs:d,homepage:!1,theme:C,pageTitle:h,pageDescription:f,pageKeywords:w,titleType:m},Object(u.b)(g,{title:c?Object(u.b)(c,null):h,label:"label",tabs:d,theme:C}),d&&Object(u.b)(N,{title:h,slug:S,tabs:d,currentTab:P}),Object(u.b)(v.a,{padded:!0},a,Object(u.b)(j,{relativePagePath:p}),Object(u.b)(T,{date:I})),Object(u.b)(O.a,{pageContext:t,location:n,slug:S,tabs:d,currentTab:P}),Object(u.b)(o.a,null))}},"5HYz":function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return s})),a.d(t,"default",(function(){return u}));var n=a("wx14"),c=a("zLVn"),i=(a("q1tI"),a("7ljp")),r=a("013z"),s=(a("qKvR"),{}),o=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",t)}},l=o("AnchorLinks"),b=o("AnchorLink"),p=o("InlineNotification"),m={_frontmatter:s},d=r.a;function u(e){var t=e.components,a=Object(c.a)(e,["components"]);return Object(i.b)(d,Object(n.a)({},m,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"This documentation aims to be a introductory hands-on lab for the security feature of IBM Event Streams."),Object(i.b)(l,{mdxType:"AnchorLinks"},Object(i.b)(b,{mdxType:"AnchorLink"},"Security considerations"),Object(i.b)(b,{mdxType:"AnchorLink"},"IAM Concept Summary"),Object(i.b)(b,{mdxType:"AnchorLink"},"Event Streams access management concepts"),Object(i.b)(b,{mdxType:"AnchorLink"},"Pre-requisites"),Object(i.b)(b,{mdxType:"AnchorLink"},"Add access group to the account using IAM"),Object(i.b)(b,{mdxType:"AnchorLink"},"Limiting topic access to group of users"),Object(i.b)(b,{mdxType:"AnchorLink"},"Authentication with API Keys"),Object(i.b)(b,{mdxType:"AnchorLink"},"Control application access"),Object(i.b)(b,{mdxType:"AnchorLink"},"Encryption at rest")),Object(i.b)("h2",null,"Security considerations"),Object(i.b)("p",null,"There are a lot of security requirements to address to secure platform and solution, in this section we will list some of them"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Secure data access")," which include data in motion or at rest encryption, connection and isolation via private network. Support to Virtual Private Network and bring your own keys."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Control access to Kafka cluster")," and resources like topics, using role based access control, SAML tokens and TLS certificates. Bring your own keys."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Monitor and audit")," to provide audit log and secured APIs access"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"User onboarding"),": define application specific service accounts, and admin users for devOps staff. ")),Object(i.b)("h2",null,"IAM Concept Summary"),Object(i.b)("p",null,"To undertand the Identity and access management you can read ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/iam?topic=iam-iamoverview"},"this article"),"."),Object(i.b)("p",null,"To summarize:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Account represents the billable entity, and can have multiple users."),Object(i.b)("li",{parentName:"ul"},"Users are given access to resource groups."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"}," Identity")," concept consists of user identities, service and app identities, API keys, and resources."),Object(i.b)("li",{parentName:"ul"},"Applications and IBM Cloud Services are identified with a service ID."),Object(i.b)("li",{parentName:"ul"},"To restrict permissions for using specific services, you can assign specific access policies to the service ID and user ID"),Object(i.b)("li",{parentName:"ul"},"Resource groups are here to organize any type of resources (services, clusters, VMs…) that are managed by  Identity and Access Management (IAM)."),Object(i.b)("li",{parentName:"ul"},"Resource groups are not scoped by location."),Object(i.b)("li",{parentName:"ul"},"API keys can be use to authenticate user or a service / application."),Object(i.b)("li",{parentName:"ul"},"To control access three components are used: access groups, resources and access policies.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Access group are used to organize a set of users and service IDs into a single entity and easily assign permissions via ",Object(i.b)("em",{parentName:"li"},"access policies")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"Policies")," give permission to access account resources. Policies include a subject (user, service, access group), target (resource), and role."),Object(i.b)("li",{parentName:"ul"},"Policy can be set to all resources in a resource group"),Object(i.b)("li",{parentName:"ul"},"There are two types of access ",Object(i.b)("em",{parentName:"li"},"roles"),": platform management and service access.")))),Object(i.b)("p",null,"Here is the main page for the IAM service on IBM Cloud where an account owner can manage the different components of the security control:"),Object(i.b)("img",{src:"./images/iam-main-page.png",alt:"1"}),Object(i.b)("h2",null,"Event Streams access management concepts"),Object(i.b)("p",null,"This section is a quick overview of the ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/services/EventStreams?topic=eventstreams-security"},"Managing access to your Event Streams resources")," article."),Object(i.b)("h3",null,"Roles"),Object(i.b)("p",null,"Users can perform specific tasks when they are assigned to a role for which access policies are defined. The roles defined for Event Streams are ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-security#what_secure"},"Reader, Writer and Manager"),"."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"Reader"),": Users can view Event Streams resources, and applications can only consume records"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"Writer")," : Users can edit resource, and applications can produce and consume records"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"Manager"),": Users can do privileged actions.")),Object(i.b)("h3",null,"Assign access"),Object(i.b)("p",null,"The product documentation addresses how to assign access in ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-security#assign_access"},"this section"),"."),Object(i.b)("p",null,"The type of Kafka resources that may be secured are: ",Object(i.b)("em",{parentName:"p"},"cluster, topic, group, or transaction id"),". In this lab we will give topic access to users within a group and application by using service ID."),Object(i.b)("h2",null,"Pre-requisites"),Object(i.b)("p",null,"This lab requires the following components to work against:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"An IBM Cloud account. Get a IBM Cloud Account by using the register link in ",Object(i.b)("a",{parentName:"li",href:"https://cloud.ibm.com/login"},"https://cloud.ibm.com/login"),"\nCreate a new account is free of charge."),Object(i.b)("li",{parentName:"ol"},"IBM Cloud CLI (",Object(i.b)("a",{parentName:"li",href:"https://cloud.ibm.com/docs/cli?topic=cloud-cli-getting-started"},"https://cloud.ibm.com/docs/cli?topic=cloud-cli-getting-started"),")"),Object(i.b)("li",{parentName:"ol"},"IBM CLoud CLI Event Streams plugin (",Object(i.b)("inlineCode",{parentName:"li"},"ibmcloud plugin install event-streams"),")")),Object(i.b)("h2",null,"Add access group to the account using IAM"),Object(i.b)("p",null,"The goal of this step is to create an access group to access Event Streams services as administrator."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"From the IBM Cloud main page, go to the Manage > IAM menu on top right of IBM Cloud Dashboard page:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-access-1.png",alt:"2"}),Object(i.b)("p",{parentName:"li"},"This should lead you to the main IAM page as illustrated in figure below:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-main-page.png",alt:"21"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Under the Access Group, you can create a new group of users. This will be an administrator group:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-new-ag.png",alt:"3"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Then add users to this newly created group, by selecting users from the list, (those users were invited to join the account at some time) and Click on ",Object(i.b)("inlineCode",{parentName:"p"},"Add to group")," link."),Object(i.b)("img",{parentName:"li",src:"./images/iam-ag-add-user.png",alt:"4"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Finally, you want now to add ",Object(i.b)("em",{parentName:"p"},"Access Policies")," to control access to Event Streams clusters. For that click ",Object(i.b)("em",{parentName:"p"},"Assign access")," button:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-ap-1.png",alt:"5"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Then select the type of resource (Event Streams), you want to define the access policy on:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-ap-2.png",alt:"6"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Then specify that the group can manage all instances of Event Streams service. The condition applies to the service instance with a ",Object(i.b)("em",{parentName:"p"},"Manager")," role:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-ap-3.png",alt:"7"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Add the policy and assign it to the group. You could stay in the same panel to add more target to the policy."),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-ap-4.png",alt:"8"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"The newly created, ",Object(i.b)("em",{parentName:"p"},"access policies for administer / manager")," to any Event Streams services is now listed in the access group:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-ap-5.png",alt:"9"}))),Object(i.b)("p",null,"Any user who has a manager role for either ‘All’ services or ‘All’ Event Streams services in the same account will also have full access."),Object(i.b)("h2",null,"Limiting topic access to group of users"),Object(i.b)("p",null,"The product document illustrates some access control common scenarios in ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/services/EventStreams?topic=eventstreams-security#security_scenarios"},"this section"),". We recommend reading those settings."),Object(i.b)("p",null,"In this step we are implementing one of the classical scenario: suppose we have a line of business that will create topics by applying a naming convention where topic name starts with a prefix like: ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-*"),".  We want users and service ID to  get read / write access to only those topics matching those prefix."),Object(i.b)("p",null,"To do so you need to:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Add an access group to include member of the line of business: ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-group"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Define an access policy with the following criterias:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Event streams as resource type"),Object(i.b)("li",{parentName:"ul"},"All regions"),Object(i.b)("li",{parentName:"ul"},"Specifying one of the Event Streams resource instance (the one you provisioned ",Object(i.b)("a",{parentName:"li",href:"/refarch-eda/technology/event-streams/es-cloud/"},"in this lab"),")"),Object(i.b)("li",{parentName:"ul"},"Select the service instance that hosts the target cluster"),Object(i.b)("li",{parentName:"ul"},"Specify the resource type to be ",Object(i.b)("strong",{parentName:"li"},"topic")),Object(i.b)("li",{parentName:"ul"},"And the resource ID to matches ",Object(i.b)("inlineCode",{parentName:"li"},"bn-lob1-*"))),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-top-1.png",alt:"T1"}),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Then add a second rule to enforce read access at the cluster level:")),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-top-2.png",alt:"T2"}),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Assign the two rules:")),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-top-3.png",alt:"T3"}),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"The group has the two access policies:")),Object(i.b)("img",{parentName:"li",src:"./images/iam-es-top-4.png",alt:"T4"}))),Object(i.b)("h2",null,"Authentication with API Keys"),Object(i.b)("p",null,"To let an application to remotely authenticate itself, Event Streams uses API keys.\nThe goal of this section, is to create API keys so applications, tools, scripts can connect to the newly created IBM Event Streams instance. You will create three keys for the different roles: creation of topics, read access only and read/write access."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"In your IBM Event Streams instance service page, click on ",Object(i.b)("em",{parentName:"p"},"Service credentials")," on the left hand side menu:"),Object(i.b)("img",{parentName:"li",src:"images/8.png",alt:"8"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Observe, there is no service credentials yet and click on the ",Object(i.b)("em",{parentName:"p"},"New credential")," button on the top right corner:"),Object(i.b)("img",{parentName:"li",src:"images/9.png",alt:"9"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Enter a name for your service, choose ",Object(i.b)("em",{parentName:"p"},"Manager")," role for now and click on ",Object(i.b)("em",{parentName:"p"},"Add"),":"),Object(i.b)("img",{parentName:"li",src:"images/10.png",alt:"10"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"You should now see your new service credential and be able to inspect its details if you click on its dropdown arrow on it left:"),Object(i.b)("img",{parentName:"li",src:"images/11.png",alt:"11"}))),Object(i.b)("p",null,"Using the same process you can add a credential for Writer Role. For the Reader role you will use the CLI in the next section."),Object(i.b)("p",null,"API Key is used for the ",Object(i.b)("inlineCode",{parentName:"p"},"sasl.jaas.config")," conncection properties in Kafka consumer or producer:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-properties"},'security.protocol=SASL_SSL\nssl.protocol=TLSv1.2\nssl.enabled.protocols=TLSv1.2\nssl.endpoint.identification.algorithm=HTTPS\nsasl.mechanism=PLAIN\nsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="token" password="am....5";\n')),Object(i.b)("h3",null,"Adding Keys with CLI"),Object(i.b)("p",null,"You could create the service credentials using the CLI, so you will add ",Object(i.b)("em",{parentName:"p"},"Reader")," role API Keys:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"First you can explore the service credentials created previously, using the CLI with ",Object(i.b)("inlineCode",{parentName:"p"},"$ ibmcloud resource service-key <service_credentials_name>"),":"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"$ ibmcloud resource service-key demo-serv-cred\nRetrieving service key demo-serv-cred in all resource groups under account bill's Account as A......\n\nName:          demo-serv-cred\nID:            crn:v1:bluemix:public:messagehub:eu-de:a/b636d1d8.....8cfa:b05be932-2....02e687a:resource-key:4ba348d2-...-360e983d99c5\nCreated At:    Tue May 12 10:53:02 UTC 2020\nState:         active\nCredentials:\n            api_key:                  *****\n            apikey:                   *****\n            iam_apikey_description:   Auto-generated for key 4ba348d2-5fcf-4c13-a265-360e983d99c5\n            iam_apikey_name:          demo-serv-cred\n            iam_role_crn:             crn:v1:bluemix:public:iam::::serviceRole:Manager\n            iam_serviceid_crn:        crn:v1:bluemix:public:iam-identity::a/b636d1d83e34d7ae7e904591ac248cfa::serviceid:ServiceId-380e866c-5914-4e01-85c4-d80bd1b8a899\n            instance_id:              b05be932-2a60-4315-951d-a6dd902e687a\n            kafka_admin_url:          https://mh-tcqsppdpzlrkdmkbgmgl-4c201a12d7add7c99d2b22e361c6f175-0000.eu-de.containers.appdomain.cloud\n            kafka_brokers_sasl:       [kafka-2.mh-tcqsppdpzlrkdmkbgmgl-4c201a12d7add7c99d2b22e361c6f175-0000.eu-de.containers.appdomain.cloud:9093 kafka-0.mh-tcqsppdpzlrkdmkbgmgl-4c201a12d7add7c99d2b22e361c6f175-0000.eu-de.containers.appdomain.cloud:9093 kafka-1.mh-tcqsppdpzlrkdmkbgmgl-4c201a12d7add7c99d2b22e361c6f175-0000.eu-de.containers.appdomain.cloud:9093]\n            kafka_http_url:           https://mh-tcqsppdpzlrkdmkbgmgl-4c201a12d7add7c99d2b22e361c6f175-0000.eu-de.containers.appdomain.cloud\n            password:                 *****\n            user:                     token\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Add a ",Object(i.b)("inlineCode",{parentName:"p"},"Reader")," role API key:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},'# Get the name of the event streams service:\nibmcloud resource service-instances\nibmcloud resource service-key-create bn-lob1-app-reader Reader --instance-name "Event Streams-wn"\n\nOK\nService key crn:v1:bluemix:public:messagehub:eu-de:a/b6...248cfa:b05...e687a:resource-key:7ee00.....15a2 was created.\n\nName:          bn-lob1-reader\nID:            crn:v1:bluemix:public:messagehub:eu-de:a/b636d..fa:b05b..7a:resource-key:7ee0042.....b15a2\nCreated At:    Wed May 13 00:33:49 UTC 2020\nState:         active\nCredentials:\n            api_key:                  xrvMI4PQYmdOcUwPRUJXy6Xlo9UCY9xywNUPiU3jjpKH\n            apikey:                   xrvMI4PQYmdOcUwPRUJXy6Xlo9UCY9xywNUPiU3jjpKH\n            iam_apikey_description:   Auto-generated for key 7ee0042f-572b-46f6-b9cc-912cc63b15a2\n            iam_apikey_name:          bn-lob1-reader\n            iam_role_crn:             crn:v1:bluemix:public:iam::::serviceRole:Reader\n            iam_serviceid_crn:        crn:v1:bluemix:public:iam-identity::a/b636d1....48cfa::serviceid:ServiceId-b4d3....18af1\n            instance_id:              b05....687a\n            kafka_admin_url:          https://mh-tcqsppdpzlrkdmkbgmgl-4c201a...1c6f175-0000.eu-de.containers.appdomain.cloud\n            kafka_brokers_sasl:       [kafka-0.mh-tcqsppdpzlrkdmkbgmgl-4c2...175-0000.eu-de.containers.appdomain.cloud:9093....]\n            kafka_http_url:           https://mh-tcqsppdpzlrkdmkbgmgl-4c20...-0000.eu-de.containers.appdomain.cloud\n            password:                 xr......KH\n            user:                     token\n')))),Object(i.b)("h2",null,"Control application access"),Object(i.b)("p",null,"The last step of this lab is to add a specific IAM group for applications so you can link any future applications to a group so that producer and consumer codes using the Writer role API key as defined previously\ncan read and write to specific topic as defined by an access policy."),Object(i.b)("p",null,"We want to give this Writer role API key to the ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-app")," group, so applications within this group can create topics and R/W on those topics with the name ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-*"),".\nTo do so, we have to add to the Access Group ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-app"),", the service ID that maps the Key created above:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"In IAM Access groups select the service IDs tab and click on add service id button:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-ag-serv-1.png",alt:"SI1"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Search for the service ID name: ",Object(i.b)("inlineCode",{parentName:"p"},"bn-lob1-writer")," and"),Object(i.b)("img",{parentName:"li",src:"./images/iam-ag-serv-2.png",alt:"SI2"})),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"You should get this result:"),Object(i.b)("img",{parentName:"li",src:"./images/iam-ag-serv-3.png",alt:"SI3"}))),Object(i.b)("h3",null,"Kafka Streams specifics"),Object(i.b)("p",null,"A lot of Kafka implementations use Kafka Streams API, in this case the applications need to have ",Object(i.b)("inlineCode",{parentName:"p"},"Manager")," role on topic resource,\nand Reader role for cluster and group with a Manager API Key."),Object(i.b)("h3",null,"Connecting application using API Key"),Object(i.b)("p",null,"To connect to Event Streams on cloud, we need to define consumer and producer common configuration as presented in the ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-kafka_using#kafka_api_client"},"product documentation")),Object(i.b)("p",null,"Here is an exemple of using reactive messaging in microprofile with the liberty kafka connector:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-properties"},'mp.messaging.connector.liberty-kafka.security.protocol=SASL_SSL\nmp.messaging.connector.liberty-kafka.ssl.protocol=TLSv1.2\nmp.messaging.connector.liberty-kafka.sasl.mechanism=PLAIN\nmp.messaging.connector.liberty-kafka.sasl.jaas.config="org.apache.kafka.common.security.plain.PlainLoginModule required username=token password=longapikeycomingfromservicecredential;"\n')),Object(i.b)("p",null,"These properties could in fact be part of a secret in Kubernetes and used by the pod."),Object(i.b)("h2",null,"Encryption at rest"),Object(i.b)("p",null,"Event Streams stores message data at rest and message logs on encrypted disks. Event Streams supports customer-managed encryption with provided key: bring you own key. This feature is available on the Enterprise plan only. The ",Object(i.b)("a",{parentName:"p",href:"https://cloud.ibm.com/docs/EventStreams?topic=EventStreams-managing_encryption"},"product documentation")," addresses in detail this capability."),Object(i.b)("p",null,"In this section, we just want to present some step by step to play with Key Protect, defining root key, and get Wrapped Keys to be used for encryption."),Object(i.b)("h3",null,"Create a Key Protect instance"),Object(i.b)("p",null,"In the ",Object(i.b)("inlineCode",{parentName:"p"},"Create resource")," from the IBM Cloud dashboard page, select a ",Object(i.b)("inlineCode",{parentName:"p"},"Key Protect")," service, add a name, and select a resource pool:"),Object(i.b)("img",{src:"./images/key-protect-1.png",alt:"kp1"}),Object(i.b)("h3",null,"Create a root key or upload yours"),Object(i.b)("p",null,"Using the ",Object(i.b)("inlineCode",{parentName:"p"},"Manage")," menu of Key Protect, and ",Object(i.b)("inlineCode",{parentName:"p"},"Add key")," button:"),Object(i.b)("img",{src:"./images/key-protect-2.png",alt:"kp2"}),Object(i.b)("p",null,"Specify to import your own key or create a new one. Give a name"),Object(i.b)("img",{src:"./images/key-protect-3.png",alt:"kp3"}),Object(i.b)("p",null,"Keys are symmetric 256-bit keys, supported by the AES-CBC-PAD algorithm. For added security, keys are generated by FIPS 140-2 Level 3 certified hardware security modules (HSMs) that are located in secure IBM Cloud data centers"),Object(i.b)("img",{src:"./images/key-protect-4.png",alt:"kp4"}),Object(i.b)("p",null,"Get the cloud resource name from the newly create key:"),Object(i.b)("img",{src:"./images/key-protect-5.png",alt:"kp5"}),Object(i.b)("h3",null,"Get a Wrapped Key with API:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"export GUID=$(ibmcloud resource service-instance eda-KeyProtect --id | grep crn | awk '{print $2}’)\nexport TOKEN=$(ibmcloud iam oauth-tokens | awk '{print $4 }'\n)\ncurl -X POST https://us-south.kms.cloud.ibm.com/api/v2/keys/34f2598f-e6e9-4822-8f51-cd9036e537e8?action=wrap -H 'accept: application/vnd.ibm.kms.key_action+json'    -H 'authorization: Bearer $TOKEN' -H 'bluemix-instance: $GUID'  -H 'content-type: application/vnd.ibm.kms.key_action+json'\n")),Object(i.b)("h3",null,"Authorize Event Streams to access Key Protect"),Object(i.b)("p",null,"In IAM application, go to the ",Object(i.b)("inlineCode",{parentName:"p"},"Authorizations")," menu:"),Object(i.b)("img",{src:"./images/key-protect-6.png",alt:"kp6"}),Object(i.b)("p",null,"And define event streams as the source service, you can specify a specific instance id or any event streams service. The target is the Key Protect instance. The service access is Reader."),Object(i.b)("img",{src:"./images/key-protect-7.png",alt:"kp7"}),Object(i.b)("p",null,"You should get something like:"),Object(i.b)("img",{src:"./images/key-protect-8.png",alt:"kp8"}),Object(i.b)("p",null,"Now Event Streams could use your wrapped key to encrypte data at rest."),Object(i.b)(p,{kind:"warning",mdxType:"InlineNotification"},"Temporarily des-authorizing Event Streams to access Key Protect, will block communication to Event Streams instance. Loosing any keys, will mean loosing the data. Restoring access by recreating the authorization between ES and Key Protect, will reopen traffic. When rotating the root key a new rewrapping of DEK is performed and the new key needs to be communicated to Event Streams."))}u.isMDXComponent=!0},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,a){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}}}]);
//# sourceMappingURL=component---src-pages-technology-event-streams-es-maas-security-mdx-832392b7daf6578329f4.js.map